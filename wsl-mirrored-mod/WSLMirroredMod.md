# Настройка зеркального режима для WSL

Эта инструкция поможет вам включить зеркальный режим сети для WSL, чтобы обеспечить доступ к `localhost` хост-машины из WSL на Windows 11 22H2 и выше. Подробности можно найти в [официальной документации](https://learn.microsoft.com/en-us/windows/wsl/networking).

## 1. Создайте или отредактируйте файл `.wslconfig` на хосте

1. Откройте PowerShell и выполните следующую команду для открытия файла `.wslconfig`, который должен находиться в папке профиля пользователя Windows:

   ```powershell
   notepad $env:USERPROFILE\.wslconfig
   ```
2. Добавьте в файл следующую конфигурацию:

   ```powershell
   [wsl2]
   networkingMode=mirrored
   ```
Эта настройка включает зеркальный режим сети для WSL.  

3. Сохраните и закройте файл.

## 2. Перезагрузите WSL

Для применения настроек необходимо перезагрузить WSL:

1. Откройте PowerShell от имени администратора.
2. Выполните команду:

   ```powershell
   wsl --shutdown
   ```
3. После этого снова запустите WSL.

## 3. Настройка брандмауэра Hyper-V

Чтобы WSL мог подключаться к хосту и наоборот при включенном зеркальном режиме, настройте правила брандмауэра для виртуальной машины Hyper-V:

1. Выполните следующую команду в PowerShell от имени администратора:

   ```powershell
   Set-NetFirewallHyperVVMSetting -Name '{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}' -DefaultInboundAction Allow
   ```
2. Либо создайте отдельное правило для SSH, если оно требуется для порта 22:

   ```powershell
   New-NetFirewallHyperVRule -Name "AllowSSH" -DisplayName "Allow SSH" -Direction Inbound -VMCreatorId '{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}' -Protocol TCP -LocalPorts 22
   ```

## 4. Проверьте подключение

После включения зеркального режима сети и перезагрузки WSL попробуйте подключиться к вашему серверу SSH в VirtualBox из WSL:

   ```powershell
   ssh <ваш_пользователь>@localhost -p 22
   ```

Если зеркальный режим включен, соединение должно устанавливаться.

## Примечания
- Убедитесь, что SSH-сервер в VirtualBox настроен правильно и открыт для внешних подключений.
Если проблема сохраняется, проверьте, что служба SSH на виртуальной машине работает и порт 22 доступен для подключения из внешней сети.
- После выполнения этих шагов ваш WSL должен работать в зеркальном сетевом режиме и иметь доступ к localhost хост-машины.
